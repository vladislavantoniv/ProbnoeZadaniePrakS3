<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    .container { max-width: 1400px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h1 { color: #2c3e50; border-bottom: 3px solid #f39c12; padding-bottom: 10px; }
    .back-link { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: bold; }
    .form-container { background: #fef9e7; padding: 25px; border-radius: 8px; margin: 25px 0; border-left: 4px solid #f39c12; }
    .form-container h3 { margin-top: 0; color: #2c3e50; }
    .form-group { margin: 15px 0; }
    label { display: inline-block; width: 200px; font-weight: bold; color: #2c3e50; }
    input, select, textarea { padding: 10px; width: 400px; border: 1px solid #bdc3c7; border-radius: 5px; font-size: 14px; }
    textarea { height: 80px; resize: vertical; }
    button { padding: 12px 25px; background: #f39c12; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
    button:hover { background: #e67e22; }
    .btn-complete { background: #27ae60; }
    .btn-complete:hover { background: #229954; }
    table { width: 100%; border-collapse: collapse; margin: 25px 0; }
    th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
    th { background-color: #f39c12; color: white; }
    tr:nth-child(even) { background-color: #f8f9fa; }
    .empty-message { text-align: center; color: #7f8c8d; padding: 20px; font-style: italic; }
    .status-pending { background: #f39c12; color: white; padding: 4px 8px; border-radius: 4px; }
    .status-completed { background: #27ae60; color: white; padding: 4px 8px; border-radius: 4px; }
    .result-form { background: #e8f6f3; padding: 15px; border-radius: 5px; margin: 10px 0; border: 1px solid #a3e4d7; }
    .result-form h4 { margin-top: 0; color: #2c3e50; }
  </style>
</head>
<body>
<div class="container">
  <a th:href="@{/web}" class="back-link">‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
  <h1>üß™ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏</h1>

  <div class="form-container">
    <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç–µ—Å—Ç</h3>
    <form th:action="@{/web/tests}" method="post">
      <div class="form-group">
        <label>–ó–∞—è–≤–∫–∞:</label>
        <select name="orderId" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞—è–≤–∫—É</option>
          <option th:each="order : ${orders}"
                  th:value="${order.id}"
                  th:text="'–ó–∞—è–≤–∫–∞ #' + ${order.id} + ' - ' + ${order.patient.lastName} + ' ' + ${order.patient.firstName}"></option>
        </select>
      </div>
      <div class="form-group">
        <label>–¢–∏–ø –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è:</label>
        <select name="testTypeId" required>
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</option>
          <option th:each="testType : ${testTypes}"
                  th:value="${testType.id}"
                  th:text="${testType.name + ' (' + testType.code + ') - ‚ÇΩ' + testType.price}"></option>
        </select>
      </div>
      <button type="submit">üß™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç</button>
    </form>
  </div>

  <h3>–°–ø–∏—Å–æ–∫ —Ç–µ—Å—Ç–æ–≤</h3>
  <table th:if="${not tests.empty}">
    <thead>
    <tr>
      <th>ID</th>
      <th>–ó–∞—è–≤–∫–∞</th>
      <th>–ü–∞—Ü–∏–µ–Ω—Ç</th>
      <th>–¢–∏–ø –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</th>
      <th>–°—Ç–∞—Ç—É—Å</th>
      <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
      <th>–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è</th>
      <th>–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="test : ${tests}">
      <td th:text="${test.id}"></td>
      <td th:text="'–ó–∞—è–≤–∫–∞ #' + ${test.orderId}"></td>
      <td th:text="${test.patientName}"></td>
      <td th:text="${test.testTypeName}"></td>
      <td>
        <span th:classappend="'status-' + ${test.status.name().toLowerCase()}"
              th:text="${test.status == 'PENDING' ? '–û–∂–∏–¥–∞–µ—Ç' : '–ó–∞–≤–µ—Ä—à–µ–Ω'}">
        </span>
      </td>
      <td th:text="${test.result} ?: '–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω'"></td>
      <td th:text="${test.referenceValues} ?: '–ù–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã'"></td>
      <td th:text="${test.completedDate ? #temporals.format(test.completedDate, 'dd.MM.yyyy HH:mm') : '–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ'}"></td>
      <td>
        <div th:if="${test.status.name() == 'PENDING'}">
          <button type="button" onclick="showResultForm([[${test.id}]])" class="btn-complete">üìù –í–≤–µ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
        </div>
        <div th:if="${test.status.name() == 'COMPLETED'}">
          <span style="color: #27ae60;">‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω</span>
        </div>
      </td>
    </tr>
    </tbody>
  </table>
  <div th:if="${tests.empty}" class="empty-message">
    üß™ –ù–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
  </div>

  <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤–≤–æ–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
  <div id="resultForm" class="result-form" style="display: none;">
    <h4>–í–≤–æ–¥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞</h4>
    <form id="resultFormElement" method="post">
      <div class="form-group">
        <label>–†–µ–∑—É–ª—å—Ç–∞—Ç:</label>
        <textarea name="result" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞..." required></textarea>
      </div>
      <div class="form-group">
        <label>–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:</label>
        <textarea name="referenceValues" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è..."></textarea>
      </div>
      <button type="submit" class="btn-complete">‚úÖ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
      <button type="button" onclick="hideResultForm()">‚ùå –û—Ç–º–µ–Ω–∞</button>
    </form>
  </div>
</div>

<script>
  function showResultForm(testId) {
      const form = document.getElementById('resultFormElement');
      form.action = '/web/tests/' + testId + '/result';
      document.getElementById('resultForm').style.display = 'block';
  }

  function hideResultForm() {
      document.getElementById('resultForm').style.display = 'none';
      document.getElementById('resultFormElement').reset();
  }
</script>
</body>
</html>